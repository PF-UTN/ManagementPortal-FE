<div class="main-container">
  <div class="main-container__header">
    <div class="main-container__header__row">
      <mp-title>Productos</mp-title>
      <mp-cart-button></mp-cart-button>
    </div>
  </div>
  <form [formGroup]="filterForm">
    <div class="filters-toolbar">
      <div class="filters-toolbar__search">
        <mp-input
          label="Buscar producto"
          formControlName="searchText"
          [icon]="'close'"
          type="text"
          [iconAction]="clearSearch.bind(this)"
        >
        </mp-input>
      </div>
      <div class="filters-toolbar__actions">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Filtrar por categoría</mat-label>
          <mat-select formControlName="selectedCategories" multiple>
            <mat-option
              *ngFor="let category of categories"
              [value]="category.id.toString()"
            >
              {{ category.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <div class="filters-toolbar__actions__icon">
          <button
            mat-icon-button
            [matMenuTriggerFor]="orderMenu"
            aria-label="Ordenar"
            matTooltip="Ordenar"
          >
            <mat-icon>sort_by_alpha</mat-icon>
          </button>
          <mat-menu #orderMenu="matMenu" panelClass="custom-filters-menu">
            <button
              mat-menu-item
              *ngFor="let option of orderByOptions"
              (click)="onOrderByChange(option)"
            >
              {{ option.label }}
            </button>
          </mat-menu>
        </div>
      </div>
    </div>
  </form>
  <div
    class="main-container__bg"
    infinite-scroll
    [infiniteScrollDistance]="2"
    [infiniteScrollThrottle]="150"
    [scrollWindow]="false"
    (scrolled)="onScroll()"
  >
    <div
      *ngIf="products.length === 0 && !hasMoreProducts"
      class="text-center py-5"
    >
      <mat-icon>dashboard</mat-icon>
      <h4>No se encontraron productos para tu búsqueda</h4>
      <p>Probá cambiando los filtros o el texto de búsqueda</p>
    </div>
    <div class="main-container__grid" *ngIf="products.length > 0">
      <mp-product-card
        class="main-container__grid__card"
        *ngFor="let product of products"
        [product]="product"
        [initialQuantity]="1"
        (openDrawer)="openProductDrawer($event)"
        (addToCart)="handleAddToCart($event)"
        [loading]="isCartLoadingMap()[product.id]"
      >
      </mp-product-card>
    </div>
    <ng-container *ngIf="isLoading">
      <div class="d-flex justify-content-center align-items-center py-5">
        <mp-loading></mp-loading>
      </div>
    </ng-container>
  </div>
</div>
